# ğŸ”„ Background Processing Flow Diagram

## Visual Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERACTION                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ 1. Upload image + Click search
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            FRONTEND                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  searchWithJobQueue()                                      â”‚     â”‚
â”‚  â”‚  â€¢ Prepare search params                                   â”‚     â”‚
â”‚  â”‚  â€¢ Start job                                               â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ POST /api/search-job
                                 â”‚ { categories, croppedImages, ... }
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API: /api/search-job                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  1. Create job in queue                                    â”‚     â”‚
â”‚  â”‚  2. Return job ID immediately (100ms)                      â”‚     â”‚
â”‚  â”‚  3. Start background processing (don't wait)               â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                              â”‚
                    â”‚ Returns instantly            â”‚ Processes in background
                    â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        FRONTEND              â”‚    â”‚    JOB QUEUE (Server)           â”‚
â”‚                              â”‚    â”‚                                  â”‚
â”‚  Job ID: "job_abc123"        â”‚    â”‚  Status: "processing"           â”‚
â”‚  Status: "processing"        â”‚    â”‚  Progress: 0 â†’ 25 â†’ 50 â†’ 100%  â”‚
â”‚                              â”‚    â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Start polling:     â”‚     â”‚    â”‚  â”‚ Actual search work  â”‚       â”‚
â”‚  â”‚                     â”‚     â”‚    â”‚  â”‚ â€¢ Call /api/search  â”‚       â”‚
â”‚  â”‚  Every 1.5s if     â”‚â—„â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”‚ â€¢ Process results   â”‚       â”‚
â”‚  â”‚  tab visible       â”‚ Poll â”‚    â”‚  â”‚ â€¢ Update progress   â”‚       â”‚
â”‚  â”‚                     â”‚     â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â”‚  Every 4s if       â”‚     â”‚    â”‚                                  â”‚
â”‚  â”‚  tab hidden        â”‚     â”‚    â”‚  Takes 30-50 seconds            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                              â”‚                    â”‚
â”‚  GET /api/search-job/abc123 â”‚                    â”‚
â”‚    â†“                         â”‚                    â”‚
â”‚  Response:                   â”‚                    â”‚
â”‚  {                           â”‚                    â”‚
â”‚    status: "processing",     â”‚                    â”‚
â”‚    progress: 45%             â”‚                    â”‚ Job completes
â”‚  }                           â”‚                    â–¼
â”‚                              â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ... keep polling ...        â”‚    â”‚  JOB QUEUE                      â”‚
â”‚                              â”‚    â”‚  Status: "completed"            â”‚
â”‚  GET /api/search-job/abc123 â”‚â—„â”€â”€â”€â”¤  Progress: 100%                 â”‚
â”‚    â†“                         â”‚    â”‚  Results: { ... }               â”‚
â”‚  Response:                   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  {                           â”‚
â”‚    status: "completed",      â”‚
â”‚    results: { ... }          â”‚
â”‚  }                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ Check: Is tab hidden?
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   YES (tab hidden)    â”‚
        â”‚   Show notification   â”‚
        â”‚   ğŸ”” "Search ready!"  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ User clicks notification
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Display results     â”‚
        â”‚   Show products       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Sequence Diagram

```
User          Frontend                API                  Job Queue
 â”‚               â”‚                     â”‚                       â”‚
 â”‚â”€â”€Searchâ”€â”€â”€â–º   â”‚                     â”‚                       â”‚
 â”‚               â”‚                     â”‚                       â”‚
 â”‚               â”‚â”€â”€POST /search-jobâ”€â–ºâ”‚                       â”‚
 â”‚               â”‚                     â”‚â”€â”€createJob()â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚               â”‚                     â”‚                       â”‚ Status: pending
 â”‚               â”‚                     â”‚â—„â”€jobIdâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚               â”‚â—„â”€â”€jobId, statusâ”€â”€â”€â”€â”‚                       â”‚
 â”‚               â”‚   (100ms response)  â”‚                       â”‚
 â”‚               â”‚                     â”‚                       â”‚
 â”‚               â”‚                     â”‚â”€â”€startBackground()â”€â”€â–ºâ”‚
 â”‚               â”‚                     â”‚                       â”‚ Status: processing
 â”‚               â”‚                     â”‚                       â”‚ Progress: 0%
 â”‚               â”‚                     â”‚                       â”‚
 â”‚               â”‚â”€â”€GET /job/[id]â”€â”€â”€â”€â”€â–ºâ”‚                       â”‚
 â”‚               â”‚  (poll #1)          â”‚â”€â”€getJob()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚               â”‚                     â”‚â—„â”€status, progressâ”€â”€â”€â”‚ Progress: 15%
 â”‚               â”‚â—„â”€â”€{progress: 15%}â”€â”€â”€â”‚                       â”‚
 â”‚               â”‚                     â”‚                       â”‚
 â”‚â—„â”€Update UIâ”€â”€â”‚                     â”‚                       â”‚
 â”‚  Progress:   â”‚                     â”‚                       â”‚
 â”‚  [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] â”‚                     â”‚                       â”‚
 â”‚               â”‚                     â”‚                       â”‚
 â”‚â”€â”€Switches     â”‚                     â”‚                       â”‚
 â”‚  to another   â”‚ ğŸ‘ï¸ Page hidden     â”‚                       â”‚
 â”‚  tab â”€â”€â”€â”€â”€â”€â–º  â”‚ (slow polling)      â”‚                       â”‚
 â”‚               â”‚                     â”‚                       â”‚
 â”‚  (30s pass)   â”‚â”€â”€GET /job/[id]â”€â”€â”€â”€â”€â–ºâ”‚                       â”‚
 â”‚               â”‚  (poll #2, 4s later)â”‚â”€â”€getJob()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚               â”‚                     â”‚â—„â”€status, progressâ”€â”€â”€â”‚ Progress: 45%
 â”‚               â”‚â—„â”€â”€{progress: 45%}â”€â”€â”€â”‚                       â”‚
 â”‚               â”‚                     â”‚                       â”‚
 â”‚  (more time)  â”‚                     â”‚                       â”‚
 â”‚               â”‚â”€â”€GET /job/[id]â”€â”€â”€â”€â”€â–ºâ”‚                       â”‚
 â”‚               â”‚  (poll #3)          â”‚â”€â”€getJob()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚               â”‚                     â”‚â—„â”€completed, resultsâ”€â”‚ Progress: 100%
 â”‚               â”‚â—„â”€â”€{results: {...}}â”€â”€â”‚                       â”‚ Status: completed
 â”‚               â”‚                     â”‚                       â”‚
 â”‚               â”‚â”€â”€Check visibilityâ”€â”€â”€â”‚                       â”‚
 â”‚               â”‚  Tab hidden? YES    â”‚                       â”‚
 â”‚               â”‚                     â”‚                       â”‚
 â”‚â—„â”€ğŸ”” Notificationâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚  "Search ready!"                    â”‚                       â”‚
 â”‚                                     â”‚                       â”‚
 â”‚â”€â”€Click notifâ”€â”€â–º                     â”‚                       â”‚
 â”‚                                     â”‚                       â”‚
 â”‚â—„â”€Show resultsâ”€â”€                     â”‚                       â”‚
```

---

## State Transitions

```
JOB LIFECYCLE
â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PENDING â”‚  Job created, not yet started
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ processSearchJob() called
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PROCESSING â”‚  Background work happening
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  Progress: 0% â†’ 100%
     â”‚
     â”œâ”€â”€Successâ”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚            â”‚ COMPLETED â”‚  Results available
     â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â””â”€â”€Errorâ”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  FAILED  â”‚  Error message stored
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Page Visibility States

```
USER TAB VISIBILITY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tab Visible  â”‚  Poll interval: 1.5 seconds
â”‚ User watchingâ”‚  Show progress bar
â”‚ (Active)     â”‚  No notifications
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ User switches away
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tab Hidden   â”‚  Poll interval: 4 seconds (battery saving)
â”‚ Background   â”‚  No UI updates needed
â”‚ (Inactive)   â”‚  Enable notifications
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Job completes
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Show         â”‚  Browser notification
â”‚ Notification â”‚  "ğŸ”” Search ready!"
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ User clicks
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tab Visible  â”‚  Focus window
â”‚ Show Results â”‚  Display products
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Polling Behavior

```
ADAPTIVE POLLING FREQUENCY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Tab Visible (User watching):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Time: 0s    1.5s   3s    4.5s   6s
Poll: â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚
      âœ“     âœ“     âœ“     âœ“     âœ“
      
Frequent checks = Smooth progress


Tab Hidden (User away):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Time: 0s        4s        8s        12s
Poll: â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      âœ“         âœ“         âœ“         âœ“
      
Slower checks = Battery friendly
```

---

## Data Flow

```
REQUEST LIFECYCLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Job Creation (Frontend â†’ Server)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ POST /api/search-job         â”‚
   â”‚ {                            â”‚
   â”‚   categories: ["dress"],     â”‚
   â”‚   croppedImages: {...},      â”‚
   â”‚   descriptions: {...}        â”‚
   â”‚ }                            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Response (immediate)         â”‚
   â”‚ {                            â”‚
   â”‚   jobId: "job_abc123",       â”‚
   â”‚   status: "processing"       â”‚
   â”‚ }                            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


2. Polling (Frontend â†’ Server, repeated)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ GET /api/search-job/abc123   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Response (while processing)  â”‚
   â”‚ {                            â”‚
   â”‚   id: "job_abc123",          â”‚
   â”‚   status: "processing",      â”‚
   â”‚   progress: 45               â”‚
   â”‚ }                            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼ (final poll)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Response (completed)         â”‚
   â”‚ {                            â”‚
   â”‚   id: "job_abc123",          â”‚
   â”‚   status: "completed",       â”‚
   â”‚   progress: 100,             â”‚
   â”‚   results: {                 â”‚
   â”‚     "dress": [               â”‚
   â”‚       { link, thumbnail }    â”‚
   â”‚     ]                        â”‚
   â”‚   },                         â”‚
   â”‚   meta: { ... }              â”‚
   â”‚ }                            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Architecture

```
FRONTEND COMPONENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         app/page.tsx                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ handleItemsSelected()              â”‚  â”‚
â”‚  â”‚ â€¢ Calls searchWithJobQueue()       â”‚  â”‚
â”‚  â”‚ â€¢ Updates progress state           â”‚  â”‚
â”‚  â”‚ â€¢ Displays results                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ imports
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   lib/searchJobClient.ts                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ searchWithJobQueue()               â”‚  â”‚
â”‚  â”‚ â€¢ startSearchJob()                 â”‚  â”‚
â”‚  â”‚ â€¢ pollJobUntilComplete()           â”‚  â”‚
â”‚  â”‚ â€¢ Page Visibility API              â”‚  â”‚
â”‚  â”‚ â€¢ Notification API                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


BACKEND COMPONENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   app/api/search-job/route.ts          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ POST handler                       â”‚  â”‚
â”‚  â”‚ â€¢ Creates job                      â”‚  â”‚
â”‚  â”‚ â€¢ Returns immediately              â”‚  â”‚
â”‚  â”‚ â€¢ Starts background process        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   lib/jobQueue.ts                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ createJob()                        â”‚  â”‚
â”‚  â”‚ updateJobProgress()                â”‚  â”‚
â”‚  â”‚ completeJob()                      â”‚  â”‚
â”‚  â”‚ getJob()                           â”‚  â”‚
â”‚  â”‚ In-memory Map storage              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   app/api/search-job/[id]/route.ts     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ GET handler                        â”‚  â”‚
â”‚  â”‚ â€¢ Returns job status               â”‚  â”‚
â”‚  â”‚ â€¢ Returns results if complete      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Advantages

```
OLD SYSTEM                    NEW SYSTEM
â•â•â•â•â•â•â•â•â•â•                    â•â•â•â•â•â•â•â•â•â•

Browser Request               Job Creation
     â”‚                             â”‚
     â”œâ”€ 40 seconds â”€â–º              â”œâ”€ 100ms â”€â–º Job ID
     â”‚                             â”‚
[If tab switches,             Server Processing
 request freezes]                  â”‚
     â”‚                        â”œâ”€ 40 seconds â”€â–º
     â”‚                        â”‚ (runs independently)
     â–¼                             â”‚
  Results                     Polling Checks
  (if tab still active)            â”‚
                              â”œâ”€ Every 1-5s â”€â–º
                                   â”‚
                                   â–¼
                              Results + Notification
                              (even if tab hidden)

âŒ Blocked by browser         âœ… Never blocked
âŒ One point of failure       âœ… Resilient polling
âŒ No notifications           âœ… Browser notifications
âŒ Must watch page            âœ… Works in background
```

---

This visual guide should help understand how all the pieces fit together! ğŸ¨

