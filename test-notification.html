<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Browser Notifications</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            margin-top: 0;
            color: #333;
        }
        button {
            background: #0070f3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px 10px 0;
        }
        button:hover {
            background: #0051cc;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            background: #f0f0f0;
        }
        .status.granted {
            background: #d4edda;
            color: #155724;
        }
        .status.denied {
            background: #f8d7da;
            color: #721c24;
        }
        .instructions {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>üîî Browser Notification Tester</h1>
        
        <div class="status" id="status">
            <strong>Status:</strong> <span id="permission-status">Checking...</span>
        </div>

        <button id="request-btn" onclick="requestPermission()">
            Request Permission
        </button>

        <button id="notify-btn" onclick="showNotification()" disabled>
            Show Test Notification
        </button>

        <button id="delayed-btn" onclick="showDelayedNotification()">
            Show Notification in 5s (Switch tabs!)
        </button>

        <div class="instructions">
            <h3>üìã Test Instructions</h3>
            <ol>
                <li>Click "Request Permission" and allow notifications</li>
                <li>Click "Show Test Notification" to test</li>
                <li>Click "Show Notification in 5s" then <strong>switch to another tab</strong></li>
                <li>Wait 5 seconds - notification should appear!</li>
            </ol>
        </div>

        <div style="margin-top: 30px;">
            <h3>üêõ Debug Info</h3>
            <div style="background: #f4f4f4; padding: 15px; border-radius: 6px; font-family: monospace; font-size: 14px;">
                <div><strong>Permission:</strong> <span id="debug-permission"></span></div>
                <div><strong>Page Hidden:</strong> <span id="debug-hidden"></span></div>
                <div><strong>Browser:</strong> <span id="debug-browser"></span></div>
                <div><strong>Notification Support:</strong> <span id="debug-support"></span></div>
            </div>
        </div>
    </div>

    <script>
        // Check initial state
        function updateStatus() {
            const permission = Notification.permission;
            const statusEl = document.getElementById('status');
            const permissionStatusEl = document.getElementById('permission-status');
            const notifyBtn = document.getElementById('notify-btn');
            
            permissionStatusEl.textContent = permission;
            
            if (permission === 'granted') {
                statusEl.className = 'status granted';
                notifyBtn.disabled = false;
            } else if (permission === 'denied') {
                statusEl.className = 'status denied';
                notifyBtn.disabled = true;
            } else {
                statusEl.className = 'status';
                notifyBtn.disabled = true;
            }

            // Update debug info
            document.getElementById('debug-permission').textContent = permission;
            document.getElementById('debug-hidden').textContent = document.hidden ? 'Yes' : 'No';
            document.getElementById('debug-browser').textContent = navigator.userAgent.split(' ').slice(-2).join(' ');
            document.getElementById('debug-support').textContent = 'Notification' in window ? 'Yes' : 'No';
        }

        // Request permission
        async function requestPermission() {
            if (!('Notification' in window)) {
                alert('This browser does not support notifications');
                return;
            }

            try {
                const permission = await Notification.requestPermission();
                console.log('Permission result:', permission);
                updateStatus();
                
                if (permission === 'granted') {
                    showNotification('Permission granted! üéâ');
                }
            } catch (error) {
                console.error('Permission request error:', error);
                alert('Error requesting permission: ' + error.message);
            }
        }

        // Show notification
        function showNotification(message = 'Test notification') {
            if (Notification.permission !== 'granted') {
                alert('Please grant notification permission first');
                return;
            }

            try {
                const notification = new Notification('‚ú® Test Notification', {
                    body: message || 'This is a test notification from your MVP!',
                    icon: '/favicon.ico',
                    badge: '/favicon.ico',
                    tag: 'test-notification',
                    requireInteraction: false,
                });

                notification.onclick = () => {
                    console.log('Notification clicked!');
                    window.focus();
                    notification.close();
                };

                // Auto-close after 10 seconds
                setTimeout(() => notification.close(), 10000);

                console.log('Notification shown successfully');
            } catch (error) {
                console.error('Notification error:', error);
                alert('Error showing notification: ' + error.message);
            }
        }

        // Show delayed notification (test background)
        function showDelayedNotification() {
            alert('Notification will appear in 5 seconds.\n\nSwitch to another tab NOW to test background notifications!');
            
            let countdown = 5;
            const countdownInterval = setInterval(() => {
                console.log(`Notification in ${countdown} seconds...`);
                countdown--;
            }, 1000);

            setTimeout(() => {
                clearInterval(countdownInterval);
                
                if (document.hidden) {
                    console.log('‚úÖ Page is hidden - perfect for testing!');
                    showNotification('You switched tabs! This notification appeared in the background. üéâ');
                } else {
                    console.log('‚ö†Ô∏è Page is still visible - try switching tabs next time');
                    showNotification('Page is still visible. Try switching tabs next time!');
                }
            }, 5000);
        }

        // Monitor page visibility changes
        document.addEventListener('visibilitychange', () => {
            const hidden = document.hidden;
            console.log(`üëÅÔ∏è Page visibility changed: ${hidden ? 'HIDDEN' : 'VISIBLE'}`);
            updateStatus();
        });

        // Initial update
        updateStatus();
        
        // Update debug info every second
        setInterval(updateStatus, 1000);

        console.log('üîî Notification tester loaded');
        console.log('Current permission:', Notification.permission);
    </script>
</body>
</html>

